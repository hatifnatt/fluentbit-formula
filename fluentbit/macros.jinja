{% set tplroot = tplfile.split('/')[0] %}

{% macro build_source(source='', path_prefix='templates', default_source='', indent_width=6) -%}
{% set url = '' -%}
{% if source -%}
    {%- if source.startswith('salt://') or source.startswith('/') %}
        {%- set url = '- ' ~ source %}
    {%- else %}
        {%- set url = '- salt://' ~ tplroot ~ '/' ~ path_prefix ~ '/' ~ source %}
    {%- endif %}
{% else -%}
    {%- set url = '- salt://' ~ tplroot ~ '/' ~ path_prefix ~ '/' ~ default_source %}
{% endif -%}
{{ url|indent(indent_width, True) }}
{%- endmacro %}

{% macro format_kwargs(kwarg) %}
    {%- filter indent(4) %}
        {%- for k, v in kwarg|dictsort %}
- {{ k }}: {{ v }}
        {%- endfor %}
    {%- endfilter %}
{% endmacro %}
